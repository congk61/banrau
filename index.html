<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω B√°n H√†ng Ch·ª£ Pro</title>
    <style>
        html {
            scroll-behavior: smooth;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #10b981;
            --primary-dark: #059669;
            --secondary: #f59e0b;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f97316;
            --info: #3b82f6;
            --light: #f8fafc;
            --dark: #1e293b;
            --border: #e2e8f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #16a34a 100%);
            color: white;
            padding: 28px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.2);
        }

        .header-left h1 {
            font-size: 28px;
            margin-bottom: 5px;
            font-weight: 700;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 12px 18px;
            border-radius: 12px;
            text-align: center;
            min-width: 100px;
        }

        .stat-value {
            font-size: 22px;
            font-weight: 700;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 2px;
        }

        .tabs {
            display: flex;
            background: var(--light);
            border-bottom: 2px solid var(--border);
            overflow-x: auto;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .tab {
            flex: 1;
            padding: 16px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            white-space: nowrap;
            min-width: 120px;
        }

        .tab:hover {
            background: #e0e7ff;
            color: var(--primary);
        }

        .tab.active {
            background: white;
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .tab-content {
            display: none;
            padding: 24px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .toolbar {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 14px 45px 14px 45px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            font-size: 18px;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 16px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s;
            color: #64748b;
        }

        .filter-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            border: none;
            border-radius: 14px;
            padding: 0;
            transition: all 0.3s ease;
            background: white;
            overflow: hidden;
            position: relative;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .product-card:hover {
            box-shadow: 0 12px 28px rgba(16, 185, 129, 0.15);
            transform: translateY(-8px);
        }

        .product-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }

        .product-content {
            padding: 14px;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .product-name {
            font-size: 17px;
            font-weight: 700;
            color: var(--dark);
            flex: 1;
        }

        .product-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-available {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-out {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-low {
            background: #fef3c7;
            color: #92400e;
        }

        .product-price {
            color: var(--danger);
            font-size: 18px;
            font-weight: 700;
            margin: 8px 0;
        }

        .product-meta {
            display: flex;
            gap: 15px;
            margin: 12px 0;
            font-size: 13px;
            color: #64748b;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .unit-selector {
            display: flex;
            gap: 6px;
            margin: 12px 0;
            flex-wrap: wrap;
        }

        .unit-selector button {
            flex: 1;
            min-width: 65px;
            padding: 8px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .unit-selector button:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .unit-selector button.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .quick-add {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 12px 0;
        }

        .quick-add-btn {
            padding: 6px 8px;
            border: 2px dashed var(--border);
            background: var(--light);
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #64748b;
            transition: all 0.2s;
        }

        .quick-add-btn:hover {
            border-color: var(--primary);
            background: #e0e7ff;
            color: var(--primary);
        }

        .input-group {
            margin: 8px 0;
        }

        .input-group label {
            font-size: 12px;
            color: #64748b;
            font-weight: 600;
            margin-bottom: 6px;
            display: block;
        }

        .input-group input {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #16a34a 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #16a34a 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }

        .btn-success:hover {
            box-shadow: 0 8px 20px rgba(34, 197, 94, 0.4);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .floating-cart-btn {
            position: fixed;
            right: 20px;
            bottom: 20px;
            z-index: 1000;
            border: none;
            border-radius: 50px;
            padding: 16px 24px;
            font-weight: 700;
            font-size: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            cursor: pointer;
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            transition: all 0.3s;
        }

        .floating-cart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.4);
        }

        .cart-item {
            background: white;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }

        .cart-item:hover {
            border-color: var(--primary);
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .cart-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 8px;
        }

        .cart-item-name {
            font-weight: 600;
            font-size: 15px;
            color: var(--dark);
        }

        .cart-item-price {
            font-size: 16px;
            font-weight: 700;
            color: var(--danger);
            white-space: nowrap;
        }

        .cart-item-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 8px 0 4px;
        }

        .cart-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .cart-summary {
            position: sticky;
            top: 80px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 18px 20px;
            border-radius: 16px;
            margin-top: 16px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.15);
            font-size: 14px;
        }

        .summary-total {
            font-size: 26px;
            font-weight: 700;
            margin: 12px 0;
            text-align: center;
        }

        .order-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s;
        }

        .order-card:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
            margin-bottom: 15px;
        }

        .order-id {
            font-weight: 700;
            color: var(--primary);
            font-size: 16px;
        }

        .order-date {
            font-size: 14px;
            color: #64748b;
        }

        .order-total {
            font-size: 20px;
            font-weight: 700;
            color: var(--danger);
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .analytics-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .analytics-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .analytics-label {
            color: #64748b;
            font-size: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        @media (max-width: 768px) {
            .header {
                padding: 16px;
            }

            .header h1 {
                font-size: 20px;
            }

            .header-stats {
                width: 100%;
            }

            .stat-card {
                flex: 1;
            }

            .product-grid {
                grid-template-columns: 1fr;
            }

            .product-card {
                border-radius: 14px;
            }

            .product-content {
                padding: 10px 12px;
            }

            .product-name {
                font-size: 16px;
            }

            .product-price {
                font-size: 17px;
                margin: 6px 0;
            }

            .unit-selector {
                margin: 8px 0;
            }

            .unit-selector button {
                min-width: 0;
                padding: 6px;
                font-size: 12px;
            }

            .quick-add {
                margin: 8px 0;
                gap: 6px;
            }

            .quick-add-btn {
                padding: 6px;
                font-size: 12px;
            }

            .input-group {
                margin: 6px 0;
            }

            .input-group input {
                font-size: 14px;
                padding: 7px 9px;
            }

            .btn {
                padding: 10px 14px;
                font-size: 13px;
            }

            .tab-content {
                padding: 16px;
            }

            .cart-item-details {
                grid-template-columns: 1fr;
            }

            .floating-cart-btn {
                right: 12px;
                bottom: 12px;
                padding: 12px 20px;
                font-size: 14px;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-left: 4px solid var(--success);
            border-radius: 8px;
            padding: 16px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
            max-width: 350px;
        }

        .notification.error {
            border-left-color: var(--danger);
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .cart-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .cart-modal.active {
            display: flex;
            justify-content: flex-end;
        }

        .cart-modal-content {
            width: 100%;
            max-width: 450px;
            height: 100vh;
            background: white;
            display: flex;
            flex-direction: column;
            box-shadow: -5px 0 25px rgba(0,0,0,0.2);
            animation: slideIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .cart-modal-header {
            padding: 16px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border);
        }

        .cart-modal-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .cart-modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .cart-modal-close:hover {
            transform: scale(1.1);
        }

        .cart-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .cart-modal-item {
            background: var(--light);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .cart-modal-item-info {
            flex: 1;
        }

        .cart-modal-item-name {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .cart-modal-item-detail {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 2px;
        }

        .cart-modal-item-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cart-modal-item-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 4px 8px;
            transition: transform 0.2s;
        }

        .cart-modal-item-actions button:hover {
            transform: scale(1.1);
        }

        .cart-modal-item-remove {
            background: rgba(239,68,68,0.1);
            color: var(--danger);
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 12px;
        }

        .cart-modal-item-remove:hover {
            background: rgba(239,68,68,0.2);
        }

        .cart-modal-footer {
            padding: 16px;
            border-top: 2px solid var(--border);
            background: var(--light);
        }

        .cart-modal-summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .cart-modal-summary-label {
            color: #64748b;
        }

        .cart-modal-total {
            display: flex;
            justify-content: space-between;
            font-size: 20px;
            font-weight: 700;
            padding: 12px 0;
            border-top: 2px solid white;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .cart-modal-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #64748b;
            text-align: center;
        }

        .cart-modal-empty-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        /* Modal Form Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary) 0%, #16a34a 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
        }

        .modal-body {
            padding: 24px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .modal-footer {
            padding: 16px 24px;
            background: var(--light);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            border-top: 2px solid var(--border);
        }

        .modal-footer button {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }

        @media (max-width: 768px) {
            .cart-modal-content {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <button id="floating-cart-btn" class="floating-cart-btn" onclick="openCart()" style="display:none;">
        üõí <span id="floating-cart-count">0</span> s·∫£n ph·∫©m ‚Ä¢ <span id="floating-cart-total">0</span>ƒë
    </button>

    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>üè™ Qu·∫£n L√Ω B√°n H√†ng Pro</h1>
                <p style="opacity: 0.9; font-size: 14px;">H·ªá th·ªëng POS hi·ªán ƒë·∫°i & th√¥ng minh</p>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('products', this)">üì¶ S·∫£n Ph·∫©m</button>
            <button class="tab" onclick="switchTab('cart', this)">üõí Gi·ªè H√†ng <span id="cart-badge">(0)</span></button>
            <button class="tab" onclick="switchTab('orders', this)">üìã ƒê∆°n H√†ng</button>
            <button class="tab" onclick="switchTab('settings', this)">‚öôÔ∏è C√†i ƒê·∫∑t</button>
        </div>

        <div id="products" class="tab-content active">
            <div class="toolbar">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="search-input" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m (c√≥ th·ªÉ g√µ kh√¥ng d·∫•u)..." oninput="searchProducts()">
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterProducts('all')">T·∫•t c·∫£</button>
                    <button class="filter-btn" onclick="filterProducts('available')">C√≤n h√†ng</button>
                    <button class="filter-btn" onclick="filterProducts('out')">H·∫øt h√†ng</button>
                </div>
            </div>
            <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                <button class="btn btn-warning" onclick="loadProducts(true)">üîÑ ƒê·ªìng b·ªô d·ªØ li·ªáu</button>
                <button class="btn btn-success" onclick="openAddProductModal()">‚ûï Th√™m S·∫£n Ph·∫©m</button>
            </div>
            <div id="top-products" style="margin-bottom: 10px;"></div>
            <div id="products-list" class="product-grid"></div>
            <div id="products-pagination" style="margin-top: 12px; text-align: center;"></div>
        </div>

        <div id="cart" class="tab-content">
            <div id="cart-items"></div>
            <div id="cart-summary" style="display:none;">
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>S·ªë l∆∞·ª£ng s·∫£n ph·∫©m:</span>
                        <span id="summary-items">0</span>
                    </div>
                    <div class="summary-row">
                        <span>T·ªïng ti·ªÅn h√†ng:</span>
                        <span id="summary-subtotal">0ƒë</span>
                    </div>
                    <div class="summary-total" id="summary-total">0ƒë</div>
                    <button class="btn btn-success" onclick="checkout()" style="width: 100%; margin-top: 10px; padding: 16px; font-size: 16px;">
                        ‚úÖ Thanh To√°n
                    </button>
                    <button class="btn btn-danger" onclick="clearCart()" style="width: 100%; margin-top: 10px;">
                        üóëÔ∏è X√≥a Gi·ªè H√†ng
                    </button>
                </div>
            </div>
            <div id="cart-empty" class="empty-state">
                <div class="empty-icon">üõí</div>
                <h3>Gi·ªè h√†ng tr·ªëng</h3>
                <p>Th√™m s·∫£n ph·∫©m ƒë·ªÉ b·∫Øt ƒë·∫ßu b√°n h√†ng</p>
            </div>
        </div>

        <div id="orders" class="tab-content">
            <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px; margin-bottom: 12px;">
                <h2>L·ªãch S·ª≠ ƒê∆°n H√†ng</h2>
                <div style="display: flex; flex: 1; gap: 8px; justify-content: flex-end; flex-wrap: wrap;">
                    <input type="text" id="order-search-input" placeholder="T√¨m ƒë∆°n h√†ng (m√£, s·∫£n ph·∫©m...)" 
                        oninput="searchOrders()" style="flex: 1 1 220px; min-width: 0; padding: 8px 10px; border: 2px solid var(--border); border-radius: 8px;">
                    <button class="btn btn-danger" onclick="clearOrders()">üóëÔ∏è X√≥a T·∫•t C·∫£</button>
                </div>
            </div>
            <div id="orders-list"></div>
            <div id="orders-pagination" style="margin-top: 12px; text-align: center;"></div>
        </div>

        <div id="settings" class="tab-content">
            <!-- Google Sheet URL Settings -->
            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(245, 158, 11, 0.05) 100%); padding: 20px; border-radius: 14px; margin-bottom: 25px; border: 2px solid #d1fae5;">
                <h3 style="margin-bottom: 12px; color: var(--primary);">üìä Google Sheet</h3>
                <div class="input-group">
                    <label>Link CSV Google Sheet (Chia s·∫ª c√¥ng khai)</label>
                    <input type="text" id="sheet-url-input" placeholder="Nh·∫≠p link CSV Google Sheet..." 
                        style="width: 100%; padding: 12px 14px; border: 2px solid var(--border); border-radius: 8px;">
                </div>
                <div style="font-size: 13px; color: #64748b; margin-top: 10px; line-height: 1.6;">
                    <strong>üìñ H∆∞·ªõng d·∫´n:</strong><br>
                    1. T·∫°o Google Sheet v·ªõi c·ªôt: <code style="background: var(--light); padding: 2px 6px; border-radius: 4px;">ID, T√™n, ƒê∆°n v·ªã, Gi√°, C√≤n h√†ng (X/tr·ªëng), H√¨nh ·∫£nh</code><br>
                    2. Nh·∫≠p X trong c·ªôt "C√≤n h√†ng" n·∫øu s·∫£n ph·∫©m c√≤n (ƒë·ªÉ tr·ªëng n·∫øu h·∫øt)<br>
                    3. File > Chia s·∫ª > T√¨m link xu·∫•t CSV<br>
                    4. D√°n link v√†o √¥ tr√™n v√† nh·∫•n "L∆∞u & T·∫£i l·∫°i"
                </div>
                <button class="btn btn-primary" onclick="saveSheetUrl()" 
                    style="margin-top: 12px; width: 100%;">üíæ L∆∞u & T·∫£i l·∫°i D·ªØ Li·ªáu</button>
            </div>

            <!-- Google Apps Script Settings -->
            <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(168, 85, 247, 0.05) 100%); padding: 20px; border-radius: 14px; margin-bottom: 25px; border: 2px solid #dbeafe;">
                <h3 style="margin-bottom: 12px; color: var(--info);">üîó Google Apps Script URL (ƒê·ªÉ c·∫≠p nh·∫≠t t·ª± ƒë·ªông)</h3>
                <div class="input-group">
                    <label>Deployment URL t·ª´ Google Apps Script</label>
                    <input type="text" id="apps-script-url-input" placeholder="Nh·∫≠p URL deployment..." 
                        style="width: 100%; padding: 12px 14px; border: 2px solid var(--border); border-radius: 8px;">
                </div>
                <div style="font-size: 13px; color: #64748b; margin-top: 10px; line-height: 1.6;">
                    <strong>üìñ H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t Apps Script:</strong><br>
                    1. M·ªü Google Sheet ‚Üí Tools ‚Üí Script Editor<br>
                    2. Sao ch√©p code t·ª´ file <code style="background: var(--light); padding: 2px 6px; border-radius: 4px;">GOOGLE_APPS_SCRIPT_CODE.js</code><br>
                    3. Deploy ‚Üí New deployment ‚Üí Type: Web app<br>
                    4. Execute as: Ch√≠nh b·∫°n, Access: Anyone with the link<br>
                    5. Copy URL deployment v√†o √¥ n√†y<br>
                    <br>
                    üìö Xem file <code style="background: var(--light); padding: 2px 6px; border-radius: 4px;">HUONG_DAN_CAI_DAT.md</code> ho·∫∑c <code style="background: var(--light); padding: 2px 6px; border-radius: 4px;">QUICK_START.md</code> ƒë·ªÉ h∆∞·ªõng d·∫´n chi ti·∫øt!
                </div>
                <button class="btn btn-primary" onclick="saveAppsScriptUrl()" 
                    style="margin-top: 12px; width: 100%;">üíæ L∆∞u URL Apps Script</button>
            </div>

            <!-- Storage Management -->
            <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(34, 197, 94, 0.05) 100%); padding: 20px; border-radius: 14px; margin-bottom: 25px; border: 2px solid #dbeafe;">
                <h3 style="margin-bottom: 12px; color: var(--info);">üíæ Qu·∫£n L√Ω B·ªô Nh·ªõ</h3>
                <div id="storage-display" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 15px;">
                    <div style="background: white; padding: 12px; border-radius: 8px; text-align: center; border: 2px solid var(--border);">
                        <div style="font-size: 18px; font-weight: 700; color: var(--primary);">-</div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 4px;">üì¶ S·∫£n Ph·∫©m</div>
                    </div>
                    <div style="background: white; padding: 12px; border-radius: 8px; text-align: center; border: 2px solid var(--border);">
                        <div style="font-size: 18px; font-weight: 700; color: var(--success);">-</div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 4px;">üìã ƒê∆°n H√†ng</div>
                    </div>
                    <div style="background: white; padding: 12px; border-radius: 8px; text-align: center; border: 2px solid var(--border);">
                        <div style="font-size: 18px; font-weight: 700; color: var(--warning);">-</div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 4px;">üõí Gi·ªè H√†ng</div>
                    </div>
                    <div style="background: white; padding: 12px; border-radius: 8px; text-align: center; border: 2px solid var(--border);">
                        <div style="font-size: 18px; font-weight: 700; color: var(--danger);">-</div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 4px;">üìä T·ªïng</div>
                    </div>
                </div>
                <button class="btn btn-danger" onclick="clearAllData()" 
                    style="width: 100%;">üóëÔ∏è X√≥a To√†n B·ªô D·ªØ Li·ªáu</button>
            </div>

            <!-- Units Management -->
            <h3 style="margin-bottom: 15px;">üìè Qu·∫£n L√Ω ƒê∆°n V·ªã</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px;">
                <input type="text" id="unit-search-input" placeholder="T√¨m ki·∫øm ƒë∆°n v·ªã..." 
                    oninput="searchUnits()" style="flex: 1 1 200px; min-width: 0; padding: 8px; border: 2px solid var(--border); border-radius: 8px;">
            </div>
            <div id="units-list" style="margin-bottom: 8px;"></div>
            <div id="units-pagination" style="margin-bottom: 12px; text-align: center;"></div>
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                <input type="text" id="new-unit-name" 
                    style="flex: 1 1 130px; min-width: 0; padding: 8px; border: 2px solid var(--border); border-radius: 8px;">
                <input type="number" id="new-unit-rate" step="0.01" 
                    style="flex: 1 1 110px; min-width: 0; padding: 8px; border: 2px solid var(--border); border-radius: 8px;">
                <button class="btn btn-primary" onclick="addUnit()" 
                    style="flex: 0 0 auto; padding: 8px 14px; font-size: 13px;">‚ûï Th√™m</button>
            </div>
        </div>
    </div>

    <!-- Modal Th√™m/S·ª≠a S·∫£n Ph·∫©m -->
    <div id="product-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">‚ûï Th√™m S·∫£n Ph·∫©m M·ªõi</h2>
                <button class="modal-close" onclick="closeProductModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ID S·∫£n Ph·∫©m *</label>
                    <input type="text" id="form-product-id" placeholder="Nh·∫≠p ID (v√≠ d·ª•: SP001)" required>
                </div>
                <div class="form-group">
                    <label>T√™n S·∫£n Ph·∫©m *</label>
                    <input type="text" id="form-product-name" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m" required>
                </div>
                <div class="form-group">
                    <label>ƒê∆°n V·ªã *</label>
                    <select id="form-product-unit" required>
                        <option value="">-- Ch·ªçn ƒë∆°n v·ªã --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Gi√° (ƒë) *</label>
                    <input type="number" id="form-product-price" placeholder="Nh·∫≠p gi√°" step="1000" min="0" required>
                </div>
                <div class="form-group">
                    <label>H√¨nh ·∫¢nh URL</label>
                    <input type="url" id="form-product-image" placeholder="Nh·∫≠p URL h√¨nh ·∫£nh">
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="form-product-available" checked>
                        <label style="margin: 0;">‚úì C√≤n h√†ng</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="closeProductModal()">H·ªßy</button>
                <button class="btn btn-success" onclick="saveProductToSheet()">üíæ L∆∞u</button>
            </div>
        </div>
    </div>

    <script>
        const DEFAULT_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQoan7BE8OZRhivl2amxyW-jRgxROv5N2B_F98BkYaq1ZRv_tM3b_pJ_ktnZBsRarKJlf7xQIijJ5Y9/pub?output=csv';
        let SHEET_URL = DEFAULT_SHEET_URL;
        
        let products = [];
        let cart = [];
        let orders = [];
        let currentFilter = 'all';
        let analyticsRange = 'today'; // 'today' | 'month' | 'all'
        let productSalesCache = {};
        let currentProductsPage = 1;
        let currentOrdersPage = 1;
        let currentUnitsPage = 1;
        let currentEditingProductId = null; // ƒê·ªÉ l∆∞u ID s·∫£n ph·∫©m ƒëang s·ª≠a
        let GOOGLE_APPS_SCRIPT_URL = ''; // S·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª´ settings
        let productSearchTerm = '';
        let orderSearchTerm = '';
        let unitSearchTerm = '';

        const PRODUCTS_PER_PAGE = 12;
        const ORDERS_PER_PAGE = 10;
        const UNITS_PER_PAGE = 10;
        const DEFAULT_UNITS = [
            { name: 'kg', rate: 1 },
            { name: 'l·∫°ng', rate: 0.1 }
        ];
        let units = [...DEFAULT_UNITS];

        window.onload = function() {
            loadFromStorage();
            loadSheetUrlFromStorage();
            updateStorageDisplay();

            if (products.length === 0) {
                loadProducts(true);
            } else {
                // √Åp d·ª•ng l·∫°i b·ªô l·ªçc s·∫£n ph·∫©m ƒë√£ ch·ªçn tr∆∞·ªõc ƒë√≥
                filterProducts(currentFilter);
            }

            updateCartUI();
            updateOrdersUI();
            updateUnitsUI();
            updateAnalytics();
        };

        function loadProducts(force = false) {
            if (!force && products.length > 0) return;
            
            showLoading(true);
            
            fetch(SHEET_URL, { cache: 'no-cache' })
                .then(res => res.text())
                .then(data => {
                    products = parseCSV(data);
                    saveToStorage();
                    filterProducts(currentFilter);
                    showNotification('‚úÖ ƒê√£ t·∫£i d·ªØ li·ªáu th√†nh c√¥ng!');
                })
                .catch(err => {
                    console.error(err);
                    showNotification('‚ùå L·ªói t·∫£i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i!', true);
                })
                .finally(() => showLoading(false));
        }

        function parseCSV(data) {
            const lines = data.split('\n').slice(1);
            return lines.map(line => {
                if (!line.trim()) return null;
                const parts = line.split(',').map(s => s.trim().replace(/^"|"$/g, ''));
                if (parts.length < 5) return null;
                // Ki·ªÉm tra n·∫øu c·ªôt available c√≥ ch·ª©a X, x, ‚úì, ‚úï th√¨ c√≤n h√†ng
                const statusStr = (parts[4] || '').toUpperCase();
                const available = statusStr === 'X' || statusStr === '‚úì' || statusStr === '‚úï' || statusStr === 'TRUE';
                return {
                    id: parts[0],
                    name: parts[1],
                    unit: parts[2] || 'kg',
                    price: parseFloat(parts[3]) || 0,
                    available: available,
                    image: parts[5] || 'https://via.placeholder.com/300x180?text=No+Image'
                };
            }).filter(Boolean);
        }

        function removeVietnameseTones(str) {
            return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .replace(/ƒë/g, 'd').replace(/ƒê/g, 'D').toLowerCase();
        }

        function searchProducts() {
            productSearchTerm = removeVietnameseTones(document.getElementById('search-input').value);
            currentProductsPage = 1;
            displayProducts();
        }

        function filterProducts(type) {
            currentFilter = type;
            currentProductsPage = 1;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.includes(
                    type === 'all' ? 'T·∫•t c·∫£' : type === 'available' ? 'C√≤n' : 'H·∫øt'
                ));
            });
            displayProducts();
        }

        function changeProductsPage(page) {
            if (page < 1) return;
            currentProductsPage = page;
            displayProducts();
            const productsSection = document.getElementById('products');
            if (productsSection) productsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function displayProducts() {
            // C·∫≠p nh·∫≠t cache b√°n ch·∫°y t·ª´ t·∫•t c·∫£ ƒë∆°n h√†ng
            const productSales = {};
            orders.forEach(order => {
                order.items.forEach(item => {
                    productSales[item.name] = (productSales[item.name] || 0) + item.quantity;
                });
            });
            productSalesCache = productSales;
            
            let filtered = products;
            
            if (productSearchTerm) {
                filtered = filtered.filter(p => removeVietnameseTones(p.name).includes(productSearchTerm));
            }
            
            if (currentFilter === 'available') filtered = filtered.filter(p => p.available);
            if (currentFilter === 'out') filtered = filtered.filter(p => !p.available);

            // S·∫Øp x·∫øp theo s·∫£n ph·∫©m b√°n ch·∫°y (∆∞u ti√™n s·ªë l∆∞·ª£ng b√°n cao)
            filtered = [...filtered].sort((a, b) => {
                const sa = productSalesCache[a.name] || 0;
                const sb = productSalesCache[b.name] || 0;
                if (sb !== sa) return sb - sa;
                // N·∫øu ch∆∞a b√°n, s·∫Øp theo t√™n cho ·ªïn ƒë·ªãnh
                return a.name.localeCompare(b.name, 'vi');
            });
            
            const container = document.getElementById('products-list');
            const paginationEl = document.getElementById('products-pagination');
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state" style="grid-column: 1/-1;"><div class="empty-icon">üîç</div><h3>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m</h3></div>';
                if (paginationEl) paginationEl.innerHTML = '';
                return;
            }

            const totalPages = Math.ceil(filtered.length / PRODUCTS_PER_PAGE) || 1;
            if (currentProductsPage > totalPages) currentProductsPage = totalPages;
            const start = (currentProductsPage - 1) * PRODUCTS_PER_PAGE;
            const pageItems = filtered.slice(start, start + PRODUCTS_PER_PAGE);
            
            container.innerHTML = pageItems.map(p => `
                <div class="product-card ${!p.available ? 'out-of-stock' : ''}">
                    <div class="product-content">
                        <div class="product-header">
                            <div class="product-name">${p.name} <span style="font-size: 13px; color: var(--danger); font-weight: 600;">${productSalesCache[p.name] ? `(${productSalesCache[p.name].toFixed(2)}x)` : ''}</span></div>
                            <span class="product-badge ${p.available ? 'badge-available' : 'badge-out'}">
                                ${p.available ? '‚úì C√≤n' : '‚úó H·∫øt'}
                            </span>
                        </div>
                        <div class="product-price" id="price-display-${p.id}">
                            ${formatMoney(p.price)} / ${p.unit}
                        </div>
                        <div class="unit-selector" id="unit-sel-${p.id}">
                            ${units.map(u => `
                                <button class="${u.name === p.unit ? 'active' : ''}" 
                                    onclick="selectUnit('${p.id}', '${u.name}')">
                                    ${u.name}
                                </button>
                            `).join('')}
                        </div>
                        <div class="quick-add">
                            <button class="quick-add-btn" onclick="quickAdd('${p.id}', 0.5)" ${!p.available ? 'disabled' : ''}>
                                + 0.5
                            </button>
                            <button class="quick-add-btn" onclick="quickAdd('${p.id}', 1)" ${!p.available ? 'disabled' : ''}>
                                + 1
                            </button>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <div class="input-group" style="flex: 1;">
                                <label>S·ªë l∆∞·ª£ng</label>
                                <input type="number" id="qty-${p.id}" placeholder="0" step="0.1" min="0" 
                                    oninput="calcPrice('${p.id}')" ${!p.available ? 'disabled' : ''}>
                            </div>
                            <div class="input-group" style="flex: 1;">
                                <label>Th√†nh ti·ªÅn</label>
                                <input type="number" id="total-${p.id}" placeholder="0" step="1000" min="0" 
                                    oninput="calcQty('${p.id}')" ${!p.available ? 'disabled' : ''}>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addToCart('${p.id}')" 
                            style="width: 100%; margin-top: 10px;" ${!p.available ? 'disabled' : ''}>
                            üõí Th√™m v√†o gi·ªè
                        </button>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                            <button class="btn btn-info" onclick="openEditProductModal('${p.id}')" 
                                style="flex: 1; background: #3b82f6;">
                                ‚úèÔ∏è S·ª≠a
                            </button>
                            <button class="btn btn-danger" onclick="deleteProductFromSheet('${p.id}')" 
                                style="flex: 1;">
                                üóëÔ∏è X√≥a
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            if (paginationEl) {
                paginationEl.innerHTML = totalPages > 1
                    ? `
                        <button class="filter-btn" onclick="changeProductsPage(${currentProductsPage - 1})" ${currentProductsPage === 1 ? 'disabled' : ''}>&laquo;</button>
                        <span style="margin: 0 8px; font-size: 13px;">Trang ${currentProductsPage}/${totalPages}</span>
                        <button class="filter-btn" onclick="changeProductsPage(${currentProductsPage + 1})" ${currentProductsPage === totalPages ? 'disabled' : ''}>&raquo;</button>
                    `
                    : '';
            }
        }

        function selectUnit(id, unitName) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            product.unit = unitName;
            
            document.querySelectorAll(`#unit-sel-${id} button`).forEach(btn => {
                btn.classList.toggle('active', btn.textContent.trim() === unitName);
            });
            
            const unit = units.find(u => u.name === unitName);
            const price = product.price * (unit ? unit.rate : 1);
            document.getElementById(`price-display-${id}`).textContent = 
                `${formatMoney(price)} / ${unitName}`;
            
            const qtyInput = document.getElementById(`qty-${id}`);
            if (qtyInput && qtyInput.value) calcPrice(id);
        }

        function calcPrice(id) {
            const product = products.find(p => p.id === id);
            const qty = parseFloat(document.getElementById(`qty-${id}`).value) || 0;
            const unit = units.find(u => u.name === product.unit);
            const total = qty * product.price * (unit ? unit.rate : 1);
            document.getElementById(`total-${id}`).value = Math.round(total);
        }

        function calcQty(id) {
            const product = products.find(p => p.id === id);
            const total = parseFloat(document.getElementById(`total-${id}`).value) || 0;
            const unit = units.find(u => u.name === product.unit);
            const qty = total / (product.price * (unit ? unit.rate : 1));
            document.getElementById(`qty-${id}`).value = qty.toFixed(2);
        }

        function quickAdd(id, amount) {
            const qtyInput = document.getElementById(`qty-${id}`);
            const current = parseFloat(qtyInput.value) || 0;
            qtyInput.value = (current + amount).toFixed(1);
            calcPrice(id);
        }

        function addToCart(id) {
            const product = products.find(p => p.id === id);
            const qty = parseFloat(document.getElementById(`qty-${id}`).value);
            
            if (!qty || qty <= 0) {
                showNotification('‚ö†Ô∏è Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng h·ª£p l·ªá!', true);
                return;
            }
            
            const unit = units.find(u => u.name === product.unit);
            const unitPrice = product.price * (unit ? unit.rate : 1);
            const totalPrice = qty * unitPrice;
            
            const existing = cart.find(item => item.id === id && item.unit === product.unit);
            
            if (existing) {
                existing.quantity += qty;
                existing.totalPrice = existing.quantity * existing.unitPrice;
            } else {
                cart.push({
                    id,
                    name: product.name,
                    unit: product.unit,
                    unitPrice,
                    quantity: qty,
                    totalPrice
                });
            }
            
            document.getElementById(`qty-${id}`).value = '';
            document.getElementById(`total-${id}`).value = '';
            
            updateCartUI();
            saveToStorage();
            showNotification('‚úÖ ƒê√£ th√™m v√†o gi·ªè h√†ng!');
        }

        function updateCartUI() {
            const container = document.getElementById('cart-items');
            const badge = document.getElementById('cart-badge');
            const summary = document.getElementById('cart-summary');
            const empty = document.getElementById('cart-empty');
            const floatingBtn = document.getElementById('floating-cart-btn');
            
            badge.textContent = `(${cart.length})`;
            
            if (cart.length === 0) {
                container.innerHTML = '';
                summary.style.display = 'none';
                empty.style.display = 'block';
                floatingBtn.style.display = 'none';
                return;
            }
            
            empty.style.display = 'none';
            summary.style.display = 'block';
            floatingBtn.style.display = 'block';
            
            container.innerHTML = cart.map((item, i) => `
                <div class="cart-item">
                    <div class="cart-item-header">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">${formatMoney(item.totalPrice)}</div>
                    </div>
                    <div style="font-size: 13px; color: #64748b; margin: 8px 0;">
                        ƒê∆°n gi√°: ${formatMoney(item.unitPrice)} / ${item.unit}
                    </div>
                    <div class="cart-item-details">
                        <div style="display: flex; gap: 10px;">
                            <div class="input-group" style="flex: 1;">
                                <label>S·ªë l∆∞·ª£ng (${item.unit})</label>
                                <input type="number" value="${item.quantity}" step="0.1" min="0" 
                                    oninput="updateCartItem(${i}, 'qty', this.value)">
                            </div>
                            <div class="input-group" style="flex: 1;">
                                <label>Th√†nh ti·ªÅn (ƒë)</label>
                                <input type="number" value="${Math.round(item.totalPrice)}" step="1000" min="0" 
                                    oninput="updateCartItem(${i}, 'price', this.value)">
                            </div>
                        </div>
                    </div>
                    <div class="cart-actions">
                        <button class="btn btn-danger" onclick="removeFromCart(${i})" style="flex: 1;">
                            üóëÔ∏è X√≥a
                        </button>
                    </div>
                </div>
            `).join('');
            
            const total = cart.reduce((sum, item) => sum + item.totalPrice, 0);
            document.getElementById('summary-items').textContent = cart.length;
            document.getElementById('summary-subtotal').textContent = formatMoney(total);
            document.getElementById('summary-total').textContent = formatMoney(total);
            document.getElementById('floating-cart-count').textContent = cart.length;
            document.getElementById('floating-cart-total').textContent = formatMoney(total);
            
            // C·∫≠p nh·∫≠t modal n·∫øu ƒëang m·ªü
            updateCartModalSummary();
        }

        function updateCartItem(index, type, value) {
            const item = cart[index];
            
            if (type === 'qty') {
                item.quantity = parseFloat(value) || 0;
                item.totalPrice = item.quantity * item.unitPrice;
            } else {
                item.totalPrice = parseFloat(value) || 0;
                item.quantity = item.totalPrice / item.unitPrice;
            }
            
            updateCartUI();
            saveToStorage();
        }

        function removeFromCart(index) {
            if (confirm('X√≥a s·∫£n ph·∫©m n√†y kh·ªèi gi·ªè h√†ng?')) {
                cart.splice(index, 1);
                updateCartUI();
                saveToStorage();
                showNotification('üóëÔ∏è ƒê√£ x√≥a kh·ªèi gi·ªè h√†ng!');
            }
        }

        function clearCart() {
            if (cart.length === 0) return;
            if (confirm('X√≥a to√†n b·ªô gi·ªè h√†ng?')) {
                cart = [];
                updateCartUI();
                saveToStorage();
                showNotification('üóëÔ∏è ƒê√£ x√≥a gi·ªè h√†ng!');
            }
        }

        function checkout() {
            if (cart.length === 0) {
                showNotification('‚ö†Ô∏è Gi·ªè h√†ng tr·ªëng!', true);
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + item.totalPrice, 0);
            
            // T·∫°o m√£ ƒë∆°n h√†ng: YYYYMMDD + 4 s·ªë ng·∫´u nhi√™n
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const randomNum = String(Math.floor(Math.random() * 10000)).padStart(4, '0');
            const orderId = `${year}${month}${day}${randomNum}`;
            
            orders.unshift({
                id: orderId,
                date: new Date().toLocaleString('vi-VN'),
                items: [...cart],
                total
            });
            
            cart = [];
            updateCartUI();
            updateOrdersUI();
            updateAnalytics();
            saveToStorage();
            
            showNotification(`üí∞ Thanh to√°n th√†nh c√¥ng! M√£: ${orderId}`);
        }

        function updateOrdersUI() {
            const container = document.getElementById('orders-list');
            const paginationEl = document.getElementById('orders-pagination');

            let filtered = orders;
            if (orderSearchTerm) {
                const term = removeVietnameseTones(orderSearchTerm);
                filtered = orders.filter(order => {
                    const idMatch = String(order.id).includes(orderSearchTerm);
                    const itemsText = order.items.map(it => it.name).join(' ');
                    const itemsMatch = removeVietnameseTones(itemsText).includes(term);
                    return idMatch || itemsMatch;
                });
            }
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">üìã</div><h3>Ch∆∞a c√≥ ƒë∆°n h√†ng</h3></div>';
                if (paginationEl) paginationEl.innerHTML = '';
                return;
            }

            const totalPages = Math.ceil(filtered.length / ORDERS_PER_PAGE) || 1;
            if (currentOrdersPage > totalPages) currentOrdersPage = totalPages;
            const start = (currentOrdersPage - 1) * ORDERS_PER_PAGE;
            const pageItems = filtered.slice(start, start + ORDERS_PER_PAGE);
            
            container.innerHTML = pageItems.map((order, i) => `
                <div class="order-card">
                    <div class="order-header">
                        <div>
                            <div class="order-id">#${order.id}</div>
                            <div class="order-date">üìÖ ${order.date}</div>
                        </div>
                        <div class="order-total">${formatMoney(order.total)}</div>
                    </div>
                    <div style="font-size: 14px; color: #64748b;">
                        ${order.items.map(item => `
                            <div style="padding: 8px 0; border-bottom: 1px solid var(--border);">
                                ‚Ä¢ ${item.name} - ${item.quantity} ${item.unit} √ó ${formatMoney(item.unitPrice)} = ${formatMoney(item.totalPrice)}
                            </div>
                        `).join('')}
                    </div>
                    <div style="margin-top: 12px; text-align: right;">
                        <button class="btn btn-danger" onclick="deleteOrder(${(start + i)})" style="padding: 8px 16px; font-size: 13px;">
                            üóëÔ∏è X√≥a
                        </button>
                    </div>
                </div>
            `).join('');

            if (paginationEl) {
                paginationEl.innerHTML = totalPages > 1
                    ? `
                        <button class="filter-btn" onclick="changeOrdersPage(${currentOrdersPage - 1})" ${currentOrdersPage === 1 ? 'disabled' : ''}>&laquo;</button>
                        <span style="margin: 0 8px; font-size: 13px;">Trang ${currentOrdersPage}/${totalPages}</span>
                        <button class="filter-btn" onclick="changeOrdersPage(${currentOrdersPage + 1})" ${currentOrdersPage === totalPages ? 'disabled' : ''}>&raquo;</button>
                    `
                    : '';
            }
        }

        function deleteOrder(index) {
            if (confirm('X√≥a ƒë∆°n h√†ng n√†y?')) {
                orders.splice(index, 1);
                updateOrdersUI();
                updateAnalytics();
                saveToStorage();
                showNotification('üóëÔ∏è ƒê√£ x√≥a ƒë∆°n h√†ng!');
            }
        }

        function clearOrders() {
            if (orders.length === 0) return;
            if (confirm('X√≥a to√†n b·ªô l·ªãch s·ª≠ ƒë∆°n h√†ng?')) {
                orders = [];
                updateOrdersUI();
                updateAnalytics();
                saveToStorage();
                showNotification('üóëÔ∏è ƒê√£ x√≥a l·ªãch s·ª≠!');
            }
        }

        function searchOrders() {
            orderSearchTerm = document.getElementById('order-search-input').value.trim();
            currentOrdersPage = 1;
            updateOrdersUI();
        }

        function changeOrdersPage(page) {
            if (page < 1) return;
            currentOrdersPage = page;
            updateOrdersUI();
            const ordersSection = document.getElementById('orders');
            if (ordersSection) ordersSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function updateAnalytics() {
            // C·∫≠p nh·∫≠t cache s·∫Øp x·∫øp t·ª´ t·∫•t c·∫£ ƒë∆°n h√†ng
            const productSales = {};
            orders.forEach(order => {
                order.items.forEach(item => {
                    productSales[item.name] = (productSales[item.name] || 0) + item.quantity;
                });
            });
            
            // L∆∞u cache ƒë·ªÉ s·∫Øp x·∫øp danh s√°ch s·∫£n ph·∫©m theo ƒë·ªô b√°n ch·∫°y
            productSalesCache = productSales;
        }

        function updateUnitsUI() {
            const container = document.getElementById('units-list');
            const paginationEl = document.getElementById('units-pagination');

            let filtered = units;
            if (unitSearchTerm) {
                const term = unitSearchTerm.toLowerCase();
                filtered = units.filter(u => (u.name || '').toLowerCase().includes(term));
            }

            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">üìè</div><h3>Kh√¥ng c√≥ ƒë∆°n v·ªã</h3></div>';
                if (paginationEl) paginationEl.innerHTML = '';
                return;
            }

            const totalPages = Math.ceil(filtered.length / UNITS_PER_PAGE) || 1;
            if (currentUnitsPage > totalPages) currentUnitsPage = totalPages;
            const start = (currentUnitsPage - 1) * UNITS_PER_PAGE;
            const pageItems = filtered.slice(start, start + UNITS_PER_PAGE);

            container.innerHTML = pageItems.map((u, idx) => {
                const realIndex = start + idx;
                return `
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; padding: 10px; border: 2px solid var(--border); border-radius: 8px;">
                        <input type="text" value="${u.name}" onchange="updateUnit(${realIndex}, 'name', this.value)" 
                            style="flex: 1 1 120px; min-width: 0; padding: 8px; border: 2px solid var(--border); border-radius: 6px;" ${realIndex < 2 ? 'disabled' : ''}>
                        <input type="number" value="${u.rate}" step="0.01" onchange="updateUnit(${realIndex}, 'rate', this.value)" 
                            style="flex: 1 1 100px; min-width: 0; padding: 8px; border: 2px solid var(--border); border-radius: 6px;" ${realIndex < 2 ? 'disabled' : ''}>
                        <button class="btn btn-danger" onclick="deleteUnit(${realIndex})" 
                            style="flex: 0 0 auto; padding: 8px 10px; font-size: 13px;" ${realIndex < 2 ? 'disabled' : ''}>üóëÔ∏è</button>
                    </div>
                `;
            }).join('');

            if (paginationEl) {
                paginationEl.innerHTML = totalPages > 1
                    ? `
                        <button class="filter-btn" onclick="changeUnitsPage(${currentUnitsPage - 1})" ${currentUnitsPage === 1 ? 'disabled' : ''}>&laquo;</button>
                        <span style="margin: 0 8px; font-size: 13px;">Trang ${currentUnitsPage}/${totalPages}</span>
                        <button class="filter-btn" onclick="changeUnitsPage(${currentUnitsPage + 1})" ${currentUnitsPage === totalPages ? 'disabled' : ''}>&raquo;</button>
                    `
                    : '';
            }
        }

        function searchUnits() {
            unitSearchTerm = document.getElementById('unit-search-input').value.trim();
            currentUnitsPage = 1;
            updateUnitsUI();
        }

        function changeUnitsPage(page) {
            if (page < 1) return;
            currentUnitsPage = page;
            updateUnitsUI();
            const settingsSection = document.getElementById('settings');
            if (settingsSection) settingsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function updateUnit(index, field, value) {
            if (field === 'name') units[index].name = value;
            else units[index].rate = parseFloat(value) || 0;
            saveToStorage();
            displayProducts();
        }

        function addUnit() {
            const name = document.getElementById('new-unit-name').value.trim();
            const rate = parseFloat(document.getElementById('new-unit-rate').value);
            
            if (!name || !rate || rate <= 0) {
                showNotification('‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!', true);
                return;
            }
            
            if (units.some(u => u.name.toLowerCase() === name.toLowerCase())) {
                showNotification('‚ö†Ô∏è ƒê∆°n v·ªã ƒë√£ t·ªìn t·∫°i!', true);
                return;
            }
            
            units.push({ name, rate });
            document.getElementById('new-unit-name').value = '';
            document.getElementById('new-unit-rate').value = '';
            
            updateUnitsUI();
            saveToStorage();
            displayProducts();
            showNotification('‚úÖ ƒê√£ th√™m ƒë∆°n v·ªã!');
        }

        function deleteUnit(index) {
            if (index < 2) return;

            const unitName = units[index]?.name;
            if (!unitName) return;

            // Kh√¥ng cho x√≥a ƒë∆°n v·ªã ƒëang d√πng trong s·∫£n ph·∫©m/gi·ªè/ƒë∆°n h√†ng
            const usedInProducts = products.some(p => p.unit === unitName);
            const usedInCart = cart.some(item => item.unit === unitName);
            const usedInOrders = orders.some(o => (o.items || []).some(it => it.unit === unitName));

            if (usedInProducts || usedInCart || usedInOrders) {
                showNotification(`‚ö†Ô∏è Kh√¥ng th·ªÉ x√≥a ƒë∆°n v·ªã "${unitName}" v√¨ ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng!`, true);
                return;
            }

            if (confirm('X√≥a ƒë∆°n v·ªã n√†y?')) {
                units.splice(index, 1);
                updateUnitsUI();
                saveToStorage();
                showNotification('üóëÔ∏è ƒê√£ x√≥a ƒë∆°n v·ªã!');
            }
        }

        function openCart() {
            openCartModal();
        }

        function switchTab(tabName, button) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (button) button.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function formatMoney(amount) {
            return Math.round(amount).toLocaleString('vi-VN');
        }

        function showNotification(message, isError = false) {
            const notif = document.createElement('div');
            notif.className = 'notification' + (isError ? ' error' : '');
            notif.textContent = message;
            document.body.appendChild(notif);
            
            setTimeout(() => {
                notif.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }

        function showLoading(show) {
            let overlay = document.getElementById('loading-overlay');
            if (show && !overlay) {
                overlay = document.createElement('div');
                overlay.id = 'loading-overlay';
                overlay.className = 'loading-overlay';
                overlay.innerHTML = '<div class="spinner"></div>';
                document.body.appendChild(overlay);
            } else if (!show && overlay) {
                overlay.remove();
            }
        }

        function saveToStorage() {
            localStorage.setItem('products', JSON.stringify(products));
            localStorage.setItem('cart', JSON.stringify(cart));
            localStorage.setItem('orders', JSON.stringify(orders));
            localStorage.setItem('units', JSON.stringify(units));
            localStorage.setItem('currentFilter', currentFilter);
            localStorage.setItem('analyticsRange', analyticsRange);
            updateStorageDisplay();
        }

        function loadFromStorage() {
            try {
                products = JSON.parse(localStorage.getItem('products') || '[]');
                cart = JSON.parse(localStorage.getItem('cart') || '[]');
                orders = JSON.parse(localStorage.getItem('orders') || '[]');
                units = JSON.parse(localStorage.getItem('units') || JSON.stringify(DEFAULT_UNITS));
                currentFilter = localStorage.getItem('currentFilter') || 'all';
                analyticsRange = localStorage.getItem('analyticsRange') || 'today';

                // Chu·∫©n h√≥a ƒë∆°n v·ªã ƒë·ªÉ tr√°nh hi·ªÉn th·ªã 'undefined'
                if (!Array.isArray(units) || units.length === 0) {
                    units = [...DEFAULT_UNITS];
                } else {
                    units = units.map((u, index) => {
                        // N·∫øu d·ªØ li·ªáu c≈© l√† chu·ªói: ['kg', 'l·∫°ng', ...]
                        if (typeof u === 'string') {
                            return {
                                name: u || (DEFAULT_UNITS[index]?.name || `dv${index + 1}`),
                                rate: DEFAULT_UNITS[index]?.rate || 1
                            };
                        }

                        // N·∫øu l√† object nh∆∞ng thi·∫øu field
                        const name = u && u.name ? u.name : (DEFAULT_UNITS[index]?.name || `dv${index + 1}`);
                        let rate = typeof u?.rate === 'number' && u.rate > 0 ? u.rate : (DEFAULT_UNITS[index]?.rate || 1);

                        return { name, rate };
                    });
                }

                // Chu·∫©n h√≥a s·∫£n ph·∫©m, gi·ªè h√†ng, ƒë∆°n h√†ng ƒë·ªÉ lu√¥n c√≥ ƒë∆°n v·ªã h·ª£p l·ªá
                products = products.map(p => ({
                    ...p,
                    unit: p && p.unit ? p.unit : 'kg'
                }));

                cart = cart.map(item => ({
                    ...item,
                    unit: item && item.unit ? item.unit : 'kg'
                }));

                orders = orders.map(o => ({
                    ...o,
                    items: (o.items || []).map(it => ({
                        ...it,
                        unit: it && it.unit ? it.unit : 'kg'
                    }))
                }));
            } catch (e) {
                console.error('Storage error:', e);
            }
        }

        function loadSheetUrlFromStorage() {
            const storedUrl = localStorage.getItem('sheetUrl');
            if (storedUrl) {
                SHEET_URL = storedUrl;
                document.getElementById('sheet-url-input').value = storedUrl;
            } else {
                SHEET_URL = DEFAULT_SHEET_URL;
                document.getElementById('sheet-url-input').value = DEFAULT_SHEET_URL;
            }
            
            // Load Google Apps Script URL
            const appsScriptUrl = localStorage.getItem('appsScriptUrl');
            if (appsScriptUrl) {
                GOOGLE_APPS_SCRIPT_URL = appsScriptUrl;
                document.getElementById('apps-script-url-input').value = appsScriptUrl;
            }
        }

        function saveSheetUrl() {
            const url = document.getElementById('sheet-url-input').value.trim();
            if (!url) {
                showNotification('‚ö†Ô∏è Vui l√≤ng nh·∫≠p link Google Sheet!', true);
                return;
            }
            
            localStorage.setItem('sheetUrl', url);
            SHEET_URL = url;
            
            showNotification('‚úÖ ƒê√£ l∆∞u link Google Sheet!');
            
            // T·∫£i l·∫°i d·ªØ li·ªáu t·ª´ sheet m·ªõi
            loadProducts(true);
        }

        function saveAppsScriptUrl() {
            const url = document.getElementById('apps-script-url-input').value.trim();
            if (!url) {
                showNotification('‚ö†Ô∏è Vui l√≤ng nh·∫≠p URL Google Apps Script!', true);
                return;
            }
            
            localStorage.setItem('appsScriptUrl', url);
            GOOGLE_APPS_SCRIPT_URL = url;
            
            showNotification('‚úÖ ƒê√£ l∆∞u URL Apps Script! B√¢y gi·ªù th√™m/s·ª≠a s·∫£n ph·∫©m s·∫Ω t·ª± ƒë·ªông c·∫≠p nh·∫≠t l√™n Google Sheets.');
        }

        function getStorageSize(key) {
            const data = localStorage.getItem(key) || '';
            return (new Blob([data]).size / 1024).toFixed(1);
        }

        function updateStorageDisplay() {
            const productsSize = getStorageSize('products');
            const ordersSize = getStorageSize('orders');
            const cartSize = getStorageSize('cart');
            const totalSize = (parseFloat(productsSize) + parseFloat(ordersSize) + parseFloat(cartSize)).toFixed(1);
            
            const display = document.getElementById('storage-display');
            if (display) {
                display.innerHTML = `
                    <div style="background: white; padding: 12px; border-radius: 8px; text-align: center; border: 2px solid var(--border);">
                        <div style="font-size: 18px; font-weight: 700; color: var(--primary);">${productsSize} KB</div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 4px;">üì¶ S·∫£n Ph·∫©m</div>
                    </div>
                    <div style="background: white; padding: 12px; border-radius: 8px; text-align: center; border: 2px solid var(--border);">
                        <div style="font-size: 18px; font-weight: 700; color: var(--success);">${ordersSize} KB</div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 4px;">üìã ƒê∆°n H√†ng</div>
                    </div>
                    <div style="background: white; padding: 12px; border-radius: 8px; text-align: center; border: 2px solid var(--border);">
                        <div style="font-size: 18px; font-weight: 700; color: var(--warning);">${cartSize} KB</div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 4px;">üõí Gi·ªè H√†ng</div>
                    </div>
                    <div style="background: white; padding: 12px; border-radius: 8px; text-align: center; border: 2px solid var(--border);">
                        <div style="font-size: 18px; font-weight: 700; color: var(--danger);">${totalSize} KB</div>
                        <div style="font-size: 12px; color: #64748b; margin-top: 4px;">üìä T·ªïng</div>
                    </div>
                `;
            }
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è X√≥a TO√ÄN B·ªò d·ªØ li·ªáu? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) {
                localStorage.clear();
                products = [];
                cart = [];
                orders = [];
                units = [...DEFAULT_UNITS];
                currentFilter = 'all';
                analyticsRange = 'today';
                productSalesCache = {};
                
                saveToStorage();
                updateStorageDisplay();
                updateCartUI();
                updateOrdersUI();
                updateUnitsUI();
                displayProducts();
                
                showNotification('üóëÔ∏è ƒê√£ x√≥a to√†n b·ªô d·ªØ li·ªáu!');
            }
        }

        // ===== FUNCTIONS FOR ADD/EDIT PRODUCTS =====
        
        function openAddProductModal() {
            currentEditingProductId = null;
            document.getElementById('modal-title').textContent = '‚ûï Th√™m S·∫£n Ph·∫©m M·ªõi';
            
            // X√≥a th√¥ng tin form c≈©
            document.getElementById('form-product-id').value = '';
            document.getElementById('form-product-name').value = '';
            document.getElementById('form-product-price').value = '';
            document.getElementById('form-product-image').value = '';
            document.getElementById('form-product-available').checked = true;
            
            // C·∫≠p nh·∫≠t dropdown ƒë∆°n v·ªã
            updateUnitDropdown();
            
            // M·ªü modal
            document.getElementById('product-modal').classList.add('active');
        }

        function openEditProductModal(productId) {
            currentEditingProductId = productId;
            const product = products.find(p => p.id === productId);
            
            if (!product) {
                showNotification('‚ùå Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m!', true);
                return;
            }
            
            document.getElementById('modal-title').textContent = '‚úèÔ∏è S·ª≠a S·∫£n Ph·∫©m';
            
            // ƒêi·ªÅn th√¥ng tin s·∫£n ph·∫©m v√†o form
            document.getElementById('form-product-id').value = product.id;
            document.getElementById('form-product-id').disabled = true; // Kh√¥ng s·ª≠a ID
            document.getElementById('form-product-name').value = product.name;
            document.getElementById('form-product-unit').value = product.unit;
            document.getElementById('form-product-price').value = product.price;
            document.getElementById('form-product-image').value = product.image || '';
            document.getElementById('form-product-available').checked = product.available;
            
            // C·∫≠p nh·∫≠t dropdown ƒë∆°n v·ªã
            updateUnitDropdown();
            
            // M·ªü modal
            document.getElementById('product-modal').classList.add('active');
        }

        function closeProductModal() {
            document.getElementById('product-modal').classList.remove('active');
            document.getElementById('form-product-id').disabled = false;
            currentEditingProductId = null;
        }

        function updateUnitDropdown() {
            const select = document.getElementById('form-product-unit');
            const currentValue = select.value;
            select.innerHTML = '<option value="">-- Ch·ªçn ƒë∆°n v·ªã --</option>' + 
                units.map(u => `<option value="${u.name}">${u.name}</option>`).join('');
            select.value = currentValue;
        }

        // ƒê√≥ng modal khi b·∫•m ngo√†i
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('product-modal');
            if (modal && e.target === modal) {
                closeProductModal();
            }
        });

        async function saveProductToSheet() {
            const id = document.getElementById('form-product-id').value.trim();
            const name = document.getElementById('form-product-name').value.trim();
            const unit = document.getElementById('form-product-unit').value;
            const price = parseFloat(document.getElementById('form-product-price').value) || 0;
            const image = document.getElementById('form-product-image').value.trim() || 'https://via.placeholder.com/300x180?text=No+Image';
            const available = document.getElementById('form-product-available').checked;
            
            // Validation
            if (!id || !name || !unit || price <= 0) {
                showNotification('‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin (ID, t√™n, ƒë∆°n v·ªã, gi√° > 0)!', true);
                return;
            }
            
            // Ki·ªÉm tra tr√πng ID n·∫øu th√™m m·ªõi
            if (!currentEditingProductId && products.some(p => p.id === id)) {
                showNotification('‚ö†Ô∏è ID s·∫£n ph·∫©m ƒë√£ t·ªìn t·∫°i!', true);
                return;
            }
            
            showLoading(true);
            
            try {
                if (currentEditingProductId) {
                    // S·ª≠a s·∫£n ph·∫©m
                    const productIndex = products.findIndex(p => p.id === currentEditingProductId);
                    if (productIndex >= 0) {
                        products[productIndex] = { id, name, unit, price, image, available };
                    }
                    
                    // C·∫≠p nh·∫≠t l√™n Google Sheet
                    await updateProductOnGoogleSheet(id, name, unit, price, available, image);
                    
                    showNotification('‚úÖ ƒê√£ s·ª≠a s·∫£n ph·∫©m th√†nh c√¥ng!');
                } else {
                    // Th√™m s·∫£n ph·∫©m m·ªõi
                    products.push({ id, name, unit, price, image, available });
                    
                    // C·∫≠p nh·∫≠t l√™n Google Sheet
                    await addProductToGoogleSheet(id, name, unit, price, available, image);
                    
                    showNotification('‚úÖ ƒê√£ th√™m s·∫£n ph·∫©m th√†nh c√¥ng!');
                }
                
                saveToStorage();
                filterProducts(currentFilter);
                closeProductModal();
                
            } catch (err) {
                console.error(err);
                showNotification('‚ùå L·ªói: ' + err.message, true);
            } finally {
                showLoading(false);
            }
        }

        async function addProductToGoogleSheet(id, name, unit, price, available, image) {
            // T·∫°o d√≤ng CSV m·ªõi
            const statusStr = available ? 'X' : '';
            const csvLine = [id, name, unit, price, statusStr, image].map(val => {
                // Escape quotes and wrap in quotes n·∫øu c√≥ comma
                const str = String(val).replace(/"/g, '""');
                return str.includes(',') ? `"${str}"` : str;
            }).join(',');
            
            // C·∫≠p nh·∫≠t local products
            const newProduct = { id, name, unit, price, image, available };
            
            // N·∫øu s·ª≠ d·ª•ng Google Apps Script URL
            if (GOOGLE_APPS_SCRIPT_URL) {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'addProduct',
                        data: [id, name, unit, price, statusStr, image]
                    })
                });
                const result = await response.json();
                if (!result.success) throw new Error(result.error || 'L·ªói c·∫≠p nh·∫≠t');
            }
            
            console.log('S·∫£n ph·∫©m m·ªõi ƒë∆∞·ª£c th√™m:', csvLine);
        }

        async function updateProductOnGoogleSheet(id, name, unit, price, available, image) {
            // C·∫≠p nh·∫≠t local products
            const statusStr = available ? 'X' : '';
            
            // N·∫øu s·ª≠ d·ª•ng Google Apps Script URL
            if (GOOGLE_APPS_SCRIPT_URL) {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'updateProduct',
                        productId: id,
                        data: [id, name, unit, price, statusStr, image]
                    })
                });
                const result = await response.json();
                if (!result.success) throw new Error(result.error || 'L·ªói c·∫≠p nh·∫≠t');
            }
            
            console.log('S·∫£n ph·∫©m ƒë∆∞·ª£c c·∫≠p nh·∫≠t:', id, name, unit, price);
        }

        async function deleteProductFromSheet(productId) {
            if (!confirm('‚ö†Ô∏è X√≥a s·∫£n ph·∫©m n√†y? H√†nh ƒë·ªông kh√¥ng th·ªÉ ho√†n t√°c!')) return;
            
            showLoading(true);
            try {
                products = products.filter(p => p.id !== productId);
                
                // N·∫øu s·ª≠ d·ª•ng Google Apps Script URL
                if (GOOGLE_APPS_SCRIPT_URL) {
                    const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'deleteProduct',
                            productId: productId
                        })
                    });
                    const result = await response.json();
                    if (!result.success) throw new Error(result.error || 'L·ªói x√≥a');
                }
                
                saveToStorage();
                filterProducts(currentFilter);
                showNotification('‚úÖ ƒê√£ x√≥a s·∫£n ph·∫©m th√†nh c√¥ng!');
                
            } catch (err) {
                console.error(err);
                showNotification('‚ùå L·ªói: ' + err.message, true);
            } finally {
                showLoading(false);
            }
        }
    </script>
    <!-- Modal Gi·ªè H√†ng Nhanh -->
    <div id="cart-modal" class="cart-modal">
        <div class="cart-modal-content">
            <div class="cart-modal-header">
                <h3>üõí Gi·ªè H√†ng</h3>
                <button class="cart-modal-close" onclick="closeCartModal()">‚úï</button>
            </div>
            <div class="cart-modal-body" id="cart-modal-body">
                <div class="cart-modal-empty">
                    <div class="cart-modal-empty-icon">üõí</div>
                    <h4>Gi·ªè h√†ng tr·ªëng</h4>
                </div>
            </div>
            <div class="cart-modal-footer">
                <div class="cart-modal-summary">
                    <span class="cart-modal-summary-label">S·ªë l∆∞·ª£ng:</span>
                    <span id="cart-modal-count">0</span>
                </div>
                <div class="cart-modal-total">
                    <span>T·ªïng:</span>
                    <span id="cart-modal-total">0ƒë</span>
                </div>
                <button class="btn btn-success" onclick="checkout()" style="width: 100%; padding: 12px; margin-bottom: 8px;">
                    ‚úÖ Thanh To√°n
                </button>
                <button class="btn btn-danger" onclick="closeCartModal()" style="width: 100%; padding: 12px;">
                    ƒê√≥ng
                </button>
            </div>
        </div>
    </div>

    <script>
        function openCartModal() {
            const modal = document.getElementById('cart-modal');
            const body = document.getElementById('cart-modal-body');
            
            if (cart.length === 0) {
                body.innerHTML = `
                    <div class="cart-modal-empty">
                        <div class="cart-modal-empty-icon">üõí</div>
                        <h4>Gi·ªè h√†ng tr·ªëng</h4>
                        <p style="margin-top: 10px; font-size: 13px; color: #94a3b8;">Th√™m s·∫£n ph·∫©m ƒë·ªÉ b·∫Øt ƒë·∫ßu b√°n h√†ng</p>
                    </div>
                `;
            } else {
                body.innerHTML = cart.map((item, idx) => `
                    <div class="cart-modal-item">
                        <div class="cart-modal-item-info">
                            <div class="cart-modal-item-name">${item.name}</div>
                            <div class="cart-modal-item-detail">S·ªë l∆∞·ª£ng: <strong>${item.quantity.toFixed(2)}</strong> ${item.unit}</div>
                            <div class="cart-modal-item-detail">ƒê∆°n gi√°: <strong>${formatMoney(item.unitPrice)}</strong>ƒë</div>
                            <div class="cart-modal-item-detail">Th√†nh ti·ªÅn: <strong style="color: var(--primary);">${formatMoney(item.totalPrice)}</strong>ƒë</div>
                        </div>
                        <button class="cart-modal-item-remove" onclick="removeFromCart(${idx})">X√≥a</button>
                    </div>
                `).join('');
            }
            
            updateCartModalSummary();
            modal.classList.add('active');
        }

        function closeCartModal() {
            document.getElementById('cart-modal').classList.remove('active');
        }

        // ƒê√≥ng modal khi b·∫•m ngo√†i
        document.getElementById('cart-modal').addEventListener('click', (e) => {
            if (e.target.id === 'cart-modal') {
                closeCartModal();
            }
        });

        function updateCartModalSummary() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalAmount = cart.reduce((sum, item) => sum + item.totalPrice, 0);
            
            document.getElementById('cart-modal-count').textContent = cart.length + ' s·∫£n ph·∫©m';
            document.getElementById('cart-modal-total').textContent = formatMoney(totalAmount) + 'ƒë';
        }
    </script>

</html>